---
title: "ETC513 Assignment 3: Comparison of Energy and Pollution by Country"
author:
- familyname: Chen
  othernames: Shaohu
  address: Monash Universtidy
  email: sche0232@student.monash.edu
  correspondingauthor: true
  qualifications:  Master of Business Analytics(In Progress)
- familyname: Duan
  othernames: Qian
  address: Monash Universtidy
  email: qdua0005@student.monash.edu
  correspondingauthor: true
  qualifications:  Master of Business Analytics(In Progress)
- familyname: Tsou
  othernames: Tina
  address: Monash Universtidy
  email: ttso0004@student.monash.edu
  correspondingauthor: true
  qualifications:  Master of Business Analytics(In Progress)
department: Our consultancy \newline add names &\newline add names
organization: Australian Government COVID19
bibliography: references.bib
biblio-style: authoryear-comp
linestretch: 1.5
output:
  bookdown::pdf_document2:
    template: monashreport2.tex
    fig_caption: yes
    fig_height: 5
    fig_width: 8
    includes:
      in_header: preamble.tex
    keep_tex: yes
    number_sections: yes
    citation_package: biblatex
    toc: false
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE,echo = FALSE, message = FALSE, warning = FALSE,fig.align='center'}
# Libraries
library(tidyverse)
library(readr)
library(kableExtra)
library(bookdown)
library(ggplot2)
library(plotly)
drive <- read_csv("Data/practicaldrivingexaminationresults.csv")
```

\section*{Introduction}




\section*{Step 1}

The first part focuses on the annual pass rate of different local government authority. 

```{r,echo = FALSE, message = FALSE}
year_drive <- drive %>% 
 separate(col = Month, into = c("Year","Month"),"-") %>% 
  select(Year,`Local Government Authority`)  
num_year_drive <- year_drive %>% count(Year)

num_year_drive_percentage <- drive %>% 
  separate(col = Month, into = c("Year","Month"),"-") %>% 
  select(Year,Month,`Local Government Authority`,`Exam Result`) %>% 
  count(Year,`Exam Result`) %>% 
  arrange(desc(Year)) %>% 
  rename(num = n) %>% 
  right_join(num_year_drive) %>% 
  mutate(year_percentage = num/n) %>% 
  filter(`Exam Result` == 'PASS') %>% 
  rename(pass_num = num, total_num = n) %>% 
  select(Year,year_percentage)
```


```{r,echo = FALSE, message = FALSE}
num_drive <- year_drive %>% 
  count(Year,`Local Government Authority`) %>% 
  arrange(desc(Year)) 

percentage_num_drive <- drive %>% 
 separate(col = Month, into = c("Year","Month"),"-") %>% 
  select(Year,Month,`Local Government Authority`,`Exam Result`) %>% 
  count(Year,`Local Government Authority`,`Exam Result`) %>% 
  arrange(desc(Year)) %>% 
  rename(num = n) %>% 
  right_join(num_drive)  %>% 
  mutate(percentage = num/n)%>% 
  filter(`Exam Result` == 'PASS') %>% 
  rename(pass_num = num, total_num = n)%>% 
  left_join(num_year_drive_percentage)

num_dict <- percentage_num_drive %>% count(Year) %>% rename(total_num = n)
```


```{r Fig1, message = FALSE, warning= FALSE, echo=FALSE, fig.height= 7, fig.width=15,fig.cap="Year Pass Percentage(year_percentage) and Percentage of Local Government Authority annual passing rates exceeding the total annual passing rate(num_percentage)"}
over_percentage <- percentage_num_drive %>% 
  filter(percentage > year_percentage) %>% 
  count(Year,year_percentage) %>% 
  left_join(num_dict) %>% 
  mutate(num_percentage = n / total_num) %>% 
  select(-n,-total_num) 

over_percentage_longer <-over_percentage %>% 
  pivot_longer(cols = year_percentage:num_percentage,
               names_to = "percentage",
               values_to = "vlues")

ggplot(over_percentage_longer) +
  geom_line(aes(x= as.numeric(Year),
                y = vlues*100,
                colour = percentage,
                group = percentage))+
  xlab("Year")+
  ylab("Percentage")+
  ggtitle("Year Pass Percentage and Number Percentage per year ")+
scale_y_continuous(labels = scales::percent_format(scale = 1))+
   theme_minimal() 

```

In the figure \@ref(fig:Fig1), as for the annual pass rate, it does not fluctuate greatly, and basically remained at 62.5% but the percentage of the number exceeding the annual pass rate fluctuates greatly, which may be due to missing data in some regions, however, from the data point of view, it has been in an upward phase in recent years.

```{r Tab1, message = FALSE, warning= FALSE, echo=FALSE,fig.width= 15,fig.cap="The number of times the Local Government Authority obtains the highest or lowest pass rate per year"}
count_function <- function(x){percentage_num_drive %>% 
  select(Year,`Local Government Authority`,percentage) %>% 
  group_by(Year) %>% 
  filter(percentage == x(percentage)) %>% 
  group_by(`Local Government Authority`) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count))}

max_percetage <- count_function(max) %>% head(6)
min_percetage <- count_function(min) %>% head(6)

knitr::kable(max_percetage,
             caption = "Number of time getteing the highest pass rate per year",
             booktabs = TRUE) %>%
   kable_styling(bootstrap_options  = c("striped", "hold_position")) 

knitr::kable(min_percetage,
             caption = "Number of time getteing the lowest pass rate per year",
             booktabs = TRUE) %>%
   kable_styling(bootstrap_options  = c("striped", "hold_position"))
```

In the table \@ref(tab:Tab1), BLACKALL-TAMBO REGIONAL COUNCIL has the most number of first (`r max_percetage$count[1]` times), MAREEBA SHIRE COUNCIL, NAPRANUM ABORIGINAL SHIRE COUNCIL, REDLAND CITY COUNCIL have won the last `r min_percetage$count[1]` times. 

```{r,echo = FALSE, message = FALSE}
max_min_percentage2 <- percentage_num_drive %>% 
  filter(`Local Government Authority` %in% c("BLACKALL-TAMBO REGIONAL COUNCIL",
                                             "MAREEBA SHIRE COUNCIL",
                                             "REDLAND CITY COUNCIL")) 
```

```{r Fig2, fig.height= 7, fig.width=15, echo=FALSE,message = FALSE, warning= FALSE, echo=FALSE,fig.cap="Year Pass Percentage in BLACKALL-TAMBO REGIONAL COUNCIL, BLACKALL-TAMBO REGIONAL COUNCIL, and REDLAND CITY COUNCIL"}
ggplot()+
  geom_line(max_min_percentage2,mapping = aes(x= as.numeric(Year),
                y = percentage*100,
                group = `Local Government Authority`,
                colour = `Local Government Authority`))+
  geom_line(over_percentage,mapping = aes(x = as.numeric(Year), y = year_percentage*100), 
            size = 1, color = "gold")+
  scale_y_continuous(name = "Year Pass Percentage",labels = scales::percent_format(scale = 1))+ 
  xlab("Year") +
  ggtitle("Year Pass Percentage per year")+
   theme_minimal()

```

According to the figure \@ref(fig:Fig2), the annual pass rate of BLACKALL-TAMBO REGIONAL COUNCIL has been on the rise after 2007, even reaching 100%, while the annual pass rate of MAREEBA SHIRE COUNCIL is in a downward state, and the annual pass rate of REDLAND CITY COUNCIL basically fluctuates at 55%. Especially, MAREEBA SHIRE COUNCIL and REDLAND CITY COUNCIL have been lower than the annual pass rate since 2015, which the gold line is year pass rate.

```{r Fig3, fig.height=7, fig.width=15,fig.cap="Year Pass Number in BLACKALL-TAMBO REGIONAL COUNCIL, MAREEBA SHIRE COUNCIL, and REDLAND CITY COUNCIL",echo = FALSE, message = FALSE}
ggplot()+
  geom_line(max_min_percentage2,mapping = aes(x= as.numeric(Year),
                y = pass_num,
                group = `Local Government Authority`,
                colour = `Local Government Authority`))+ 
  ylab("Number of Pass")+
  xlab("Year") +
  ggtitle("Year Pass Number per year")+
   theme_minimal() 
```

In the figure \@ref(fig:Fig3), the number of pass for three government authorities basically has little fluctuation. Interestingly, the ranking of the number of passes and the ranking of the pass rate are completely opposite. 

In conclusion, the annual pass rate has not changed much, the percentage of the number exceeding the annual pass rate fluctuates greatly. Areas with sparsely populated areas may have fewer people participating, resulting in a higher overall pass rate than areas with densely populated areas.

\section*{Step 2}


\section*{Step 3}

