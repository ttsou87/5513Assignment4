---
title: "ETC513 Assignment 3: Comparison of Energy and Pollution by Country"
author:
- familyname: Chen
  othernames: Shaohu
  address: Monash Universtidy
  email: sche0232@student.monash.edu
  correspondingauthor: true
  qualifications:  Master of Business Analytics(In Progress)
- familyname: Duan
  othernames: Qian
  address: Monash Universtidy
  email: qdua0005@student.monash.edu
  correspondingauthor: true
  qualifications:  Master of Business Analytics(In Progress)
- familyname: Tsou
  othernames: Tina
  address: Monash Universtidy
  email: ttso0004@student.monash.edu
  correspondingauthor: true
  qualifications:  Master of Business Analytics(In Progress)
department: Our consultancy \newline add names &\newline add names
organization: Australian Government 
bibliography: references.bib
biblio-style: authoryear-comp
linestretch: 1.5
output:
  bookdown::pdf_document2:
    template: monashreport2.tex
    fig_caption: yes
    fig_height: 5
    fig_width: 8
    includes:
      in_header: preamble.tex
    keep_tex: yes
    number_sections: yes
    citation_package: biblatex
    toc: false
# editor_options: 
#   chunk_output_type: console
---

```{r ,echo = FALSE, message = FALSE, warning = FALSE}
# Libraries
library(tidyverse)
library(readr)
library(kableExtra)
library(bookdown)
library(fastDummies)
library(scales)
library(broom)
drive <- read_csv("Data/practicaldrivingexaminationresults.csv")
```

\section*{Introduction}




\section*{Step 1}




\section*{Step 2}


\section*{Step 3}
<<<<<<< HEAD
In the following section, we will be analyzing the relationship between *Booking Type* and *Exam Result*. Since the variables are categorical variables, they will have to be converted into dummy variables. Then, using logistic regression to analyze their relationship, we get the following equation:

    + $Y ~ B(p)$, $log(\frac{p}{1-p}) = \beta_0 +\beta_1 X + \epsilon$
    
```{r}
drivedum <- dummy_cols(drive, select_columns =  c('Booking Type', 'Exam Result', 'Product Type Name'),
=======
```{r}
drivedum <- dummy_cols(drive, select_columns =  c('Booking Type', 'Exam Result', 
                                                  'Product Type Name'),
>>>>>>> tina_logit
                       remove_selected_columns = TRUE)
train <- drivedum[1:252813,]
test <- drivedum[252814:337084,]

<<<<<<< HEAD
logmodel <- glm(`Exam Result_PASS` ~`Booking Type_Private`, family=binomial(link='logit'),data=train)
=======
logmodel <- glm(`Exam Result_PASS` ~`Booking Type_Private` + `Number of Examinations`,
                family=binomial(link='logit'),data=train)
>>>>>>> tina_logit

summary(logmodel)

```
Looking at the p value, we see that both variables have p-value close to 0 which means they are both statistically significant when it comes to the regression. From the table above, we wee that *Booking Type_Private* affects the passing of an exam negatively compared to *Booking Type_Driving School*. The *Number of Examinations* have a very small but positive affect on the passing of an exam. So from the logistic regression we can conclude that by booking Privately it will negatively affect the passing of the exam in relations to booking by Driving School and that the number of examinations taken prior will have a very small but positive affect on the outcome.
```{r}
anova(logmodel, test="Chisq")
```

```{r accuracy}
fitted.results <- predict(logmodel,newdata=test,type='response')
fitted.results <- ifelse(fitted.results > 0.5,1,0)
misClasificError <- mean(fitted.results != test$`Exam Result_PASS`)
print(paste('Accuracy',1-misClasificError))
```
// end of logistic regression model testing

```{r frequency table}
table <- table(drive$`Booking Type`,drive$`Exam Result`)
addmargins(table)
tab.prop <-  prop.table(table, 1)
```
A quick look at the frequency table between *Booking Type* and *Exam Result* and we saw that the number of people who passed the exam is similar for both driving school and private.

```{r chisq.test}
chisq.test(drive$`Booking Type`,drive$`Exam Result`)
```
However, when we run a chi-square test, the p-value is 0.0121 so we have statistical evidence that there is a relationship between *Booking Type* and *Exam Result*.

```{r}
tab.df <- as.data.frame(tab.prop)#make frequency table into data frame
names(tab.df) <- c("Booking Type", "Result", "frequency")

ggplot(tab.df, 
       aes(x=`Booking Type`, y = frequency, fill=Result)) + 
        geom_col() +theme_minimal()
```

```{r plot_bookingtype_model}
plot_df <- augment(logmodel, type.predict = "response")

base <-
  ggplot(plot_df, aes(x = `Booking Type_Private`)) +
  geom_line(aes(y = .fitted), color = "blue") +
  labs(x = "Booking Type", y = "Pass")

base + geom_point(aes(y = `Exam Result_PASS`), alpha = 0.2)
```


